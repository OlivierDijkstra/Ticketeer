# Use the official PHP 8.2 image from the Docker Hub
FROM php:8.2-fpm

# Install system dependencies and PHP extensions
RUN apt-get update && apt-get install -y \
    # Install redis-tools
    redis-tools \
    # Install libraries needed for PHP GD extension
    libpng-dev \
    libjpeg-dev \
    libfreetype6-dev \
    # Clean up to reduce image size
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* \
    # Install PHP extensions
    && docker-php-ext-configure gd --with-freetype --with-jpeg \
    && docker-php-ext-install gd pdo pdo_mysql pcntl \
    # Install and enable Redis extension using PECL
    && pecl install redis \
    && docker-php-ext-enable redis

# Set the working directory in the container
WORKDIR /var/www

# Copy the application files to the container
COPY . /var/www

# Change ownership to www-data
RUN chown -R www-data:www-data /var/www

# Ensure writable permissions on storage and cache directories
RUN chmod -R 775 /var/www

CMD ["php", "-S", "0.0.0.0:8000", "-t", "public"]
